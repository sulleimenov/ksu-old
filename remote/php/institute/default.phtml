<? include "header.phtml"; ?>

<div class="container">
	<?php
	$getId = $this->macros('content', 'get_page_id', array('/about-institute/'));
	$value = $hierarchy->getElement($getId);
	if ($value->getValue('content')) { ?>
		<div class="lectern-history" id="<?= $value->getAltName('@alt_name') ?>">
			<div class="lectern-title"><?= $value->getValue('h1'); ?></div>
			<div class="lectern-history__box">
				<div class="lectern-history__text">
					<?
					if ($variables['@domain'] == 'pis.ksu.edu.kz') {
						$width = '770';
					} else {
						$width = '560';
					}
					$content_trim = mb_strimwidth($value->getValue('content'), 0, $width, "...");
					echo $content_trim;
					if (mb_strlen($value->getValue('content')) > $width) :
						echo '<button class="button button--more"><a href="/'.$variables['@lang'].'/'.$value->getAltName('@link').'">'.$this->translate('read_more').'</a></button>';
					endif;
				?>
				</div>
				<div class="lectern-history__img" style="background: url(<?= $value->getValue('photo'); ?>) center top no-repeat;"></div>
			</div>
		</div>
	<?php
	}
	$getId = $this->macros('content', 'get_page_id', array('/administration/'));
	$value = $hierarchy->getElement($getId);
	$valueChildren = $hierarchy->getChildrenList($getId);
	if ($value) {
	?>
		<div class="guidance-wrapper" id="<?= $value->getAltName('@alt_name') ?>">
			<div class="lectern-title"><?= $value->getValue('h1'); ?></div>
			<div class="guidance">
				<?php foreach ($valueChildren as $key) {
					$value = $hierarchy->getElement($key);
					if ($value->getIsActive()) {
				?>
					<a style="<?= $isVisible ?>" href="/<?= urlencode($variables['@lang']) . '/administration/' . $value->getAltName() ?>" class="guidance__item">
						<div class="guidance__name">
							<span><?= substr($value->getValue('name'), 0, strpos($value->getValue('name'), ' ')); ?></span>
							<?= substr($value->getValue('name'), strpos($value->getValue('name'), ' ')); ?>
						</div>
						<div class="guidance__about" title="<?= $value->place; ?>">
							<?php
							$placeSlice = mb_substr($value->getValue('place'), 0, 50);
							$placeSlice = trim($placeSlice, ',');
							echo (iconv_strlen($placeSlice) < 49 ? $placeSlice : $placeSlice . '...');
							?>
						</div>
						<div class="guidance__images" style="background-image: url(<?= $value->getValue('photo'); ?>);">
						</div>
					</a>
				<?php } } ?>
			</div>
		</div>
	<?php
	}
	$getId = $this->macros('content', 'get_page_id', array('/department/'));
	$value = $hierarchy->getElement($getId);
	?>
	<div class="lectern-list-wrapper" id="<?= $value->getAltName('@alt_name') ?>">
		<div class="lectern-title"><?= $value->getValue('h1'); ?></div>
		<div class="lectern-list">
			<?
			$getId = $this->macros('content', 'get_page_id', array('/departments/'));
			$getChildrenList = $hierarchy->getChildrenList($getId);
			if ($variables['@domain'] != 'istr.ksu.edu.kz') :
				$degree = '
				<ul class="lectern-list__info">
					<li>Бакалавриат</li>
					<li>Магистратура</li>
					<li>Докторантура</li>
				</ul>
				<div class="lectern-list__academic-degree">'.$this->translate('team_academic_degree').'</div>';
			endif;
			foreach($getChildrenList as $child) {
				$element = $hierarchy->getElement($child);
				$parentId = $hierarchy->getParent($child);
				$parent = $hierarchy->getElement($parentId);
				if ($element->getValue('header_pic')) :
					$istrImg = '<div class="lectern-list__img" style="background: url('.$element->getValue('header_pic').') top right no-repeat; background-size: contain;">&nbsp;</div>';
					$istrImgClass = 'lectern-list__item--img';
				endif;
				if($parent->getAltName() == "departments") {
					if ($element->getIsActive()) {
						echo '
							<a href="/'.urlencode($variables['@lang']).'/departments/'.$element->getAltName().'" class="lectern-list__item '.$istrImgClass.'">
								<div class="lectern-list__name" >
									'.$element->getName().'
								</div>
								'.$degree.'
								'.$istrImg.'
							</a>';
					}
				}
			}
			?>
		</div>
	</div>

	<?php
	$getId = $this->macros('content', 'get_page_id', array('/contacts/'));
	$value = $hierarchy->getElement($getId);
	if ($value) {
	?>
		<div class="lectern-contact" id="<?= $value->getAltName('@alt_name') ?>">
			<div class="lectern-title"><?= $value->getValue('h1'); ?></div>
			<div class="lectern-contact__wrapper">
				<div class="lectern-contact__list">
					<? if ($value->address) : ?>
					<div class="text-under text-under--address">
						<?= $value->getValue('address'); ?>
						<span><?= $this->translate('team_address') ?></span>
					</div>
					<? endif ?>
					<? if ($value->phone) : ?>
					<div class="text-under">
						<?= $value->getValue('phone'); ?>
						<span><?= $this->translate('team_phone') ?></span>
					</div>
					<? endif ?>
					<? if ($value->email) : ?>
					<div class="text-under">
						<?= $value->getValue('email'); ?>
						<span><?= $this->translate('team_email') ?></span>
					</div>
					<? endif ?>
					<? if ($value->youtube) : ?>
					<div class="text-under text-under--youtube">
						<div>
							<svg width="11" height="8" viewBox="0 0 11 8" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path fill-rule="evenodd" clip-rule="evenodd" d="M10.8024 1.23824C10.7412 0.956646 10.5941 0.700995 10.3814 0.506576C10.1686 0.312158 9.90081 0.188557 9.61485 0.152836C6.87665 -0.0509452 4.12711 -0.0509452 1.38891 0.152836C1.10297 0.188373 0.835151 0.311926 0.622528 0.506389C0.409906 0.700852 0.263002 0.956606 0.202145 1.23824C0.0415541 2.09864 -0.0234952 2.97414 0.00819927 3.84881C-0.0243104 4.7234 0.0399192 5.5989 0.199734 6.45938C0.260699 6.74097 0.407637 6.99666 0.620239 7.1911C0.832841 7.38555 1.1006 7.50914 1.3865 7.54479C2.75368 7.67285 4.12698 7.72401 5.4999 7.69802C6.87255 7.72402 8.24556 7.67286 9.61247 7.54479C9.89842 7.50907 10.1663 7.38547 10.379 7.19105C10.5917 6.99663 10.7388 6.74098 10.8 6.45938C10.9599 5.5989 11.0241 4.7234 10.9916 3.84881C11.0245 2.97432 10.961 2.09886 10.8024 1.23824ZM4.08248 5.56312V1.91024L7.57492 3.74586L4.08248 5.56312Z" fill="#007AFF"/>
							</svg>	
						</div>
						<a href="<?= $value->youtube ?>" target="_blank">Youtube</a>
					</div>
					<? endif ?>
					<? if ($value->facebook) : ?>
					<div class="text-under text-under--facebook">
						<div>
							<svg width="6" height="12" viewBox="0 0 6 12" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M4 4V2.8C4 2.28 4.12 2 4.96 2H6V0H4.4C2.4 0 1.6 1.32 1.6 2.8V4H0V6H1.6V12H4V6H5.76L6 4H4Z" fill="#007AFF"/>
							</svg>
						</div>
						<a href="<?= $value->facebook ?>" target="_blank">Facebook</a>
					</div>
					<? endif ?>
					<? if ($value->instagram) : ?>
					<div class="text-under text-under--inst">
						<div>
							<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path fill-rule="evenodd" clip-rule="evenodd" d="M8.25066 0H3.7503C2.75566 0 1.80175 0.39512 1.09843 1.09844C0.395112 1.80175 0 2.75566 0 3.7503V8.25066C0 9.2453 0.395112 10.1992 1.09843 10.9025C1.80175 11.6058 2.75566 12.001 3.7503 12.001H8.25066C9.24513 12.0007 10.1988 11.6055 10.9019 10.9022C11.605 10.1989 12 9.24513 12 8.25066V3.7503C12 2.75582 11.605 1.80206 10.9019 1.09877C10.1988 0.395483 9.24513 0.000252405 8.25066 0ZM10.8759 8.25066C10.8749 8.9466 10.598 9.61374 10.1059 10.1058C9.61375 10.598 8.9466 10.8749 8.25066 10.8759H3.7503C3.05428 10.8751 2.38697 10.5983 1.89482 10.1061C1.40266 9.61397 1.12585 8.94667 1.1251 8.25066V3.7503C1.12585 3.05428 1.40266 2.38699 1.89482 1.89483C2.38697 1.40267 3.05428 1.12584 3.7503 1.12509H8.25066C8.9466 1.1261 9.61375 1.403 10.1059 1.89511C10.598 2.38721 10.8749 3.05436 10.8759 3.7503V8.25066ZM5.99666 3.00024C5.40327 3.00024 4.8232 3.1762 4.32981 3.50587C3.83643 3.83554 3.4519 4.30411 3.22482 4.85234C2.99774 5.40056 2.93831 6.00381 3.05407 6.5858C3.16984 7.16779 3.45559 7.70238 3.87518 8.12197C4.29477 8.54156 4.82938 8.8273 5.41137 8.94307C5.99336 9.05883 6.5966 8.99942 7.14482 8.77234C7.69304 8.54526 8.16162 8.16071 8.49129 7.66732C8.82096 7.17393 8.99691 6.59387 8.99691 6.00048C8.99691 5.20477 8.68082 4.44164 8.11817 3.87899C7.55551 3.31633 6.79237 3.00024 5.99666 3.00024ZM5.99666 7.87563C5.62579 7.87563 5.26327 7.76565 4.9549 7.55961C4.64654 7.35356 4.40618 7.06071 4.26425 6.71807C4.12233 6.37543 4.0852 5.9984 4.15756 5.63465C4.22991 5.27091 4.40851 4.93679 4.67075 4.67455C4.933 4.4123 5.26711 4.23371 5.63086 4.16136C5.9946 4.08901 6.37163 4.12614 6.71427 4.26807C7.05691 4.40999 7.34975 4.65033 7.55579 4.9587C7.76184 5.26707 7.87181 5.62961 7.87181 6.00048C7.87105 6.49757 7.67328 6.97408 7.32178 7.32558C6.97029 7.67707 6.49375 7.87487 5.99666 7.87563ZM9.22154 2.37582C9.30061 2.37582 9.3779 2.39927 9.44364 2.4432C9.50938 2.48713 9.56063 2.54956 9.59088 2.62261C9.62114 2.69566 9.62908 2.77605 9.61366 2.8536C9.59823 2.93114 9.56014 3.00238 9.50423 3.05829C9.44832 3.1142 9.37708 3.15227 9.29953 3.1677C9.22198 3.18312 9.14162 3.17521 9.06857 3.14495C8.99552 3.11469 8.93307 3.06345 8.88914 2.99771C8.84521 2.93196 8.82177 2.85467 8.82177 2.7756C8.82227 2.7231 8.83309 2.67121 8.85364 2.6229C8.87419 2.57459 8.90406 2.5308 8.94154 2.49403C8.97902 2.45726 9.02339 2.42823 9.07208 2.4086C9.12078 2.38897 9.17284 2.37913 9.22534 2.37963L9.22154 2.37582Z" fill="#007AFF"/>
							</svg>
						</div>	
						<a href="<?= $value->instagram ?>" target="_blank">Instagram</a>
					</div>
					<? endif ?>
				</div>
				<style type="text/css">
					.lectern-contact__map {
						max-width: 700px;
						width: 100%;
						height: 300px;
					}

					@media (max-width: 1200px) {
						.lectern-contact__wrapper {
							flex-wrap: wrap;
						}

						.text-under--address {
							width: 100%;
							max-width: 100%;
						}
					}
				</style>

				<div class="lectern-contact__map">
					<?if ($variables["@domain"]=="iel.ksu.edu.kz" || $variables["@domain"]=="idl.ksu.edu.kz"):?>
					<script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3Ac400e70e09532230cc1441c9df615970a80935ba00aa447b99a8d64e2cf52bc5&amp;lang=ru_RU&amp;scroll=true"></script>
					<?elseif($variables["@domain"]=="eti.ksu.edu.kz" || $variables["@domain"]=="agro.ksu.edu.kz"):?>
					<script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3Ac9f6af9232b0a3d91216beb8bfcc5c17c08dd44340368e28871c0a47dde028c9&amp;lang=ru_RU&amp;scroll=true"></script>
					<?elseif($variables["@domain"]=="pis.ksu.edu.kz"):?>
					<script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3A3ac683d1582dbb4bec2ea5ce3b74adecee544506aea567fff7720bf3edf662c8&amp;lang=ru_RU&amp;scroll=true"></script>
					<?elseif($variables["@domain"]=="istr.ksu.edu.kz"):?>
					<script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3Ac984f9ec44482761012ac5f07f9d16ace00c6edbd0490a0211b7ff3e5b666426&amp;lang=ru_RU&amp;scroll=true"></script>
					<?endif;?>
				</div>
			</div>
		</div>
	<?php } ?>
</div>

<? include 'footer.phtml'; ?>